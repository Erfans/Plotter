!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("konva"),require("expr-eval")):"function"==typeof define&&define.amd?define("plotter",["konva","expr-eval"],e):"object"==typeof exports?exports.plotter=e(require("konva"),require("expr-eval")):t.plotter=e(t.konva,t["expr-eval"])}(window,function(t,e){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=i(1),o=i(0),n=(s=o)&&s.__esModule?s:{default:s};var l=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.width-200,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.height-200,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{minX:-5,maxX:5,minY:-5,maxY:5};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.plots=[],this.gridColor="#888",this.width=i,this.height=s,this.stage=new n.default.Stage({container:e,width:i,height:s}),this.staticLayer=new n.default.Layer({hitGraphEnabled:!1}),this.stage.add(this.staticLayer),this.plotsLayer=new n.default.Layer({draggable:!0}),this.stage.add(this.plotsLayer),this._initialRanges=a,this.setWindow(a.minX,a.maxX,a.minY,a.maxY,!0),this._drawBg(),this._drawBorder(),this.drawAxes(),this.plotsLayer.draw(),this.staticLayer.draw();var r=this;this.stage.on("dragend",function(t){r.refresh()})}return a(t,[{key:"setWindow",value:function(t,e,i,s){if(!(arguments.length>4&&void 0!==arguments[4])||arguments[4]){var a=Plotter.calcFilledRanges(t,e,i,s,this.width,this.height);t=a.minX,e=a.maxX,i=a.minY,s=a.maxY}var r=Plotter.calcTransformMatrix(t,e,i,s,this.width,this.height);this.plotsLayer.scaleX(r[0]),this.plotsLayer.scaleY(r[3]),this.plotsLayer.offsetX(-r[4]/r[0]),this.plotsLayer.offsetY(-r[5]/r[3])}},{key:"refresh",value:function(){this._drawBg(),this.drawAxes(),this._redraw(),this.plotsLayer.draw()}},{key:"drawAxes",value:function(){var t=this._calcRanges(),e=t.minX,i=t.maxX,s=t.minY,a=t.maxY,r=i-e,o=a-s;function l(t, e, i, s, a, r){var o=t.findOne("#"+e);o?(o.points(i),o.strokeWidth(a)):(o=new n.default.Line({points:i,stroke:s,strokeWidth:a,id:e,name:r,listening:!1,transformsEnabled:"none",strokeHitEnabled:!1}),t.add(o))}e-=r,i+=r,s-=o,a+=o;var h=this._scaleSize(1);function d(t,e){var i=Math.pow(10,e);return Math.round(t/i)*i}l(this.plotsLayer,"xAxis",[e,0,i,0],this.gridColor,h),l(this.plotsLayer,"yAxis",[0,s,0,a],this.gridColor,h),this.plotsLayer.find(".AxisCounter").each(function(t){t.destroy()});var u=this._scaleSize(5),f=this._scaleSize(3),c=2*-u,p=r/(this.width/60),y=Math.floor(Math.log10(p));0===(p=d(p,y))&&(p=1);var x=o/(this.height/60);0===(x=d(x,Math.floor(Math.log10(p))))&&(x=1);var g=y<0?-y:0,v=void 0,m=void 0;for(v=p;v<=i;v+=p)m=v.toFixed(g),l(this.plotsLayer,"xAxis["+m+"]",[v,-u,v,u],this.gridColor,h,"AxisCounter"),Plotter.writeMessage(this.plotsLayer,"xAxisNum["+m+"]",v-m.length*f,c,m,this.gridColor,12,"normal","AxisCounter");for(v=-p; v>=e; v-=p)m=v.toFixed(g),l(this.plotsLayer,"xAxis["+m+"]",[v,-u,v,u],this.gridColor,h,"AxisCounter"),Plotter.writeMessage(this.plotsLayer,"xAxisNum["+m+"]",v-m.length*f,c,m,this.gridColor,12,"normal","AxisCounter");for(v=x; v<=a; v+=x)m=v.toFixed(g),l(this.plotsLayer,"yAxis["+m+"]",[-u,v,u,v],this.gridColor,h,"AxisCounter"),Plotter.writeMessage(this.plotsLayer,"yAxisNum["+m+"]",c-m.length*f*2,v+f,m,this.gridColor,12,"normal","AxisCounter");for(v=-x; v>=s; v-=x)m=v.toFixed(g),l(this.plotsLayer,"yAxis["+m+"]",[-u,v,u,v],this.gridColor,h,"AxisCounter"),Plotter.writeMessage(this.plotsLayer,"yAxisNum["+m+"]",c-m.length*f*2,v+f,m,this.gridColor,12,"normal","AxisCounter")}},{key:"_writeMessage",value:function(t, e, i, s, a, r, o, l, h){l=l||"normal";var d=t.findOne("#"+e);d?(d.x(i),d.y(s),d.text(a),d.fontSize(o),d.fill(r)):(d=new n.default.Text({x:i,y:s,text:a,id:e,fontSize:o,fontFamily:"Calibri",fill:r,fontStyle:l,name:h,scaleX:1/t.scaleX(),scaleY:1/t.scaleY(),listening:!1}),t.add(d))}},{key:"plot",value:function(t, e){var i=r.Parser.parse(t),s=this._calcPoints(i),a=new n.default.Line({id:"plot"+this.plots.length,points:s,stroke:e,strokeWidth:this._scaleSize(2),draggable:!1,transformsEnabled:"none",listening:!1});this.plotsLayer.add(a),this.plotsLayer.draw(),this._addExpression(this.plots.length,t,e),i.expression=t,i.color=e,this.plots.push(i)}},{key:"_redraw",value:function(){for(var t=this._scaleSize(2),e=0; e<this.plots.length; e++){var i=this.plotsLayer.findOne("#plot"+e),s=this.plots[e],a=this._calcPoints(s);i.points(a),i.strokeWidth(t)}}},{key:"_calcPoints",value:function(t){var e=this._calcRanges(),i=e.maxX,s=e.maxX,a=e.minY,r=e.maxY,o=s-i,n=r-a,l=this._scaleSize(.05),h=this._scaleSize(1),d=[],u=a-n,f=r+n,c=s+o,p=void 0,y=void 0;for(p=i-o; p<i; p+=h)f<(y=t.evaluate({x:p}))||y<u||(d.push(p),d.push(y));for(p=i; p<s; p+=l)f<(y=t.evaluate({x:p}))||y<u||(d.push(p),d.push(y));for(p=s; p<=c; p+=h)f<(y=t.evaluate({x:p}))||y<u||(d.push(p),d.push(y));return d}},{key:"_addExpression",value:function(t, e, i){Plotter.writeMessage(this.staticLayer,"expression"+this.plots.length,10,20*this.plots.length+10,e,i,14,"bold","expression"),this.staticLayer.draw()}},{key:"clear",value:function(){for(var t=0; t<this.plots.length; t++){this.plotsLayer.findOne("#plot"+t).destroy(),this.staticLayer.findOne("#expression"+t).destroy()}this.plots=[],this.refresh(),this.staticLayer.draw()}},{key:"download",value:function(){var t=document.createElement("a");t.href=this.stage.toDataURL(),t.download="plot.png",t.click()}},{key:"_drawBg",value:function(){var t=this._calcRanges(),e=t.maxX-t.minX,i=t.maxY-t.minY,s=this.plotsLayer.findOne("#bg");s?(s.x(t.minX),s.y(t.minY),s.width(e),s.height(i)):(s=new n.default.Rect({id:"bg",x:t.minX,y:t.minY,width:e,height:i,fill:"#fff",stroke:"#fff",strokeWidth:0,opacity:0,perfectDrawEnabled:!1,shadowForStrokeEnabled:!1}),this.plotsLayer.add(s))}},{key:"_drawBorder",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#fff",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#555",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,s=new n.default.Rect({id:"border",x:0,y:0,width:this.width,height:this.height,fill:t,stroke:e,strokeWidth:i,perfectDrawEnabled:!1,listening:!1,shadowForStrokeEnabled:!1});this.staticLayer.add(s)}},{key:"resetView",value:function(){this.plotsLayer.position({x:0,y:0}),this.setWindow(this._initialRanges.minX,this._initialRanges.maxX,this._initialRanges.minY,this._initialRanges.maxY,!0),this.refresh()}},{key:"zoom",value:function(t){var e=this.plotsLayer.scale(),i=this.plotsLayer.offset();this.plotsLayer.scale({x:e.x*t,y:e.y*t}),this.plotsLayer.offset({x:i.x/t,y:i.y/t}),this.refresh()}},{key:"_calcMinRatio",value:function(t,e,i,s){var a=i/t,r=s/e;return r<a?r:a}},{key:"_calcFilledRanges",value:function(t,e,i,s,a,r){var o=e-t,n=s-i,l=void 0,h=Plotter.calcMinRatio(o,n,a,r);return o*h<a?{minX:t-(l=(a/h-o)/2),maxX:e+l,minY:i,maxY:s}:n*h<r?{minX:t,maxX:e,minY:i-(l=(r/h-n)/2),maxY:s+l}:{minX:t,maxX:e,minY:i,maxY:s}}},{key:"_calcRanges",value:function(){var t=this.plotsLayer.position().x/this.plotsLayer.scaleX(),e=this.plotsLayer.position().y/this.plotsLayer.scaleY();return{minX:this.plotsLayer.offsetX()-t,maxX:this.width/this.plotsLayer.scaleX()+this.plotsLayer.offsetX()-t,minY:this.height/this.plotsLayer.scaleY()+this.plotsLayer.offsetY()-e,maxY:this.plotsLayer.offsetY()-e}}},{key:"_scaleSize",value:function(t){return t/((Math.abs(this.plotsLayer.scaleX())+Math.abs(this.plotsLayer.scaleY()))/2)}},{key:"_calcTransformMatrix",value:function(t, e, i, s, a, r){var o=Plotter.calcMinRatio(e-t,s-i,a,r);return[o,0,0,-o,-t*o,s*o]}},{key:"getContainer",get:function(){return this.stage.container()}}]),t}();e.default=l}])});
//# sourceMappingURL=plotter.min.js.map
