!function(t,e){if("function"==typeof define&&define.amd)define(["exports","expr-eval","Konva"],e);else if("undefined"!=typeof exports)e(exports,require("expr-eval"),require("Konva"));else{var i={exports:{}};e(i.exports,t.exprEval,t.Konva),t.plotter=i.exports}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(t,e,i){"use strict";var s;function a(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function r(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i=(s=i)&&s.__esModule?s:{default:s};var o=window.Plotter=function(){function t(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.width-200,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.height-200,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{minX:-5,maxX:5,minY:-5,maxY:5},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},n=o.gridColor,l=void 0===n?"#888":n,h=o.bgColor,d=void 0===h?"#fff":h,f=o.borderColor,u=void 0===f?"#333":f,c=o.borderWidth,y=void 0===c?2:c,p=o.textFontSize,g=void 0===p?14:p,x=o.textFontStyle,v=void 0===x?"bold":x,m=o.axesWidth,w=void 0===m?1:m;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.plots=[],this.gridColor=l,this.bgColor=d,this.borderColor=u,this.borderWidth=y,this.textFontSize=g,this.textFontStyle=v,this.axesWidth=w,this.width=s,this.height=a,this.stage=new i.default.Stage({container:e,width:s,height:a}),this.staticLayer=new i.default.Layer({hitGraphEnabled:!1}),this.stage.add(this.staticLayer),this.plotsLayer=new i.default.Layer({draggable:!0}),this.stage.add(this.plotsLayer),this._initialRanges=r,this.setWindow(r.minX,r.maxX,r.minY,r.maxY,!0),this._drawBg(),this._drawBorder(),this.drawAxes(),this.plotsLayer.draw(),this.staticLayer.draw();var L=this;this.stage.on("dragend",function(t){L.refresh()})}return r(t,null,[{key:"Version",get:function(){return"1.2.0"}}]),r(t,[{key:"setWindow",value:function(e,i,s,a){if(!(arguments.length>4&&void 0!==arguments[4])||arguments[4]){var r=t.calcFilledRanges(e,i,s,a,this.width,this.height);e=r.minX,i=r.maxX,s=r.minY,a=r.maxY}var o=t.calcTransformMatrix(e,i,s,a,this.width,this.height);this.plotsLayer.scaleX(o[0]),this.plotsLayer.scaleY(o[3]),this.plotsLayer.offsetX(-o[4]/o[0]),this.plotsLayer.offsetY(-o[5]/o[3])}},{key:"refresh",value:function(){this._drawBg(),this.drawAxes(),this._redraw(),this.plotsLayer.draw()}},{key:"drawAxes",value:function(){var e=this._calcRanges(),s=e.minX,a=e.maxX,r=e.minY,o=e.maxY,n=e.rangeX,l=e.rangeY;function h(t,e,s,a,r,o){var n=t.findOne("#"+e);n?(n.points(s),n.strokeWidth(r)):(n=new i.default.Line({points:s,stroke:a,strokeWidth:r,id:e,name:o,listening:!1,transformsEnabled:"none",strokeHitEnabled:!1}),t.add(n))}s-=n,a+=n,r-=l,o+=l;var d=this._scaleSize(this.axesWidth);function f(t,e){var i=Math.pow(10,e);return Math.round(t/i)*i}h(this.plotsLayer,"xAxis",[s,0,a,0],this.gridColor,d),h(this.plotsLayer,"yAxis",[0,r,0,o],this.gridColor,d),this.plotsLayer.find(".AxisCounter").each(function(t){t.destroy()});var u=this._scaleSize(5),c=this._scaleSize(3),y=2*-u,p=n/(this.width/60),g=Math.floor(Math.log10(p));0===(p=f(p,g))&&(p=1);var x=l/(this.height/60);0===(x=f(x,Math.floor(Math.log10(p))))&&(x=1);var v,m,w=g<0?-g:0;for(v=p;v<=a;v+=p)m=v.toFixed(w),h(this.plotsLayer,"xAxis["+m+"]",[v,-u,v,u],this.gridColor,d,"AxisCounter"),t.writeMessage(this.plotsLayer,"xAxisNum["+m+"]",v-m.length*c,y,m,this.gridColor,12,"normal","AxisCounter");for(v=-p;v>=s;v-=p)m=v.toFixed(w),h(this.plotsLayer,"xAxis["+m+"]",[v,-u,v,u],this.gridColor,d,"AxisCounter"),t.writeMessage(this.plotsLayer,"xAxisNum["+m+"]",v-m.length*c,y,m,this.gridColor,12,"normal","AxisCounter");for(v=x;v<=o;v+=x)m=v.toFixed(w),h(this.plotsLayer,"yAxis["+m+"]",[-u,v,u,v],this.gridColor,d,"AxisCounter"),t.writeMessage(this.plotsLayer,"yAxisNum["+m+"]",y-m.length*c*2,v+c,m,this.gridColor,12,"normal","AxisCounter");for(v=-x;v>=r;v-=x)m=v.toFixed(w),h(this.plotsLayer,"yAxis["+m+"]",[-u,v,u,v],this.gridColor,d,"AxisCounter"),t.writeMessage(this.plotsLayer,"yAxisNum["+m+"]",y-m.length*c*2,v+c,m,this.gridColor,12,"normal","AxisCounter")}},{key:"plot",value:function(t,s){var a=e.Parser.parse(t),r=this._calcPoints(a),o=new i.default.Line({id:"plot"+this.plots.length,points:r,stroke:s,strokeWidth:this._scaleSize(2),draggable:!1,transformsEnabled:"none",listening:!1});this.plotsLayer.add(o),this.plotsLayer.draw(),this._addExpression(this.plots.length,t,s),a.expression=t,a.color=s,this.plots.push(a)}},{key:"_redraw",value:function(){for(var t=this._scaleSize(2),e=0;e<this.plots.length;e++){var i=this.plotsLayer.findOne("#plot"+e),s=this.plots[e],a=this._calcPoints(s);i.points(a),i.strokeWidth(t)}}},{key:"_calcPoints",value:function(t){var e,i,s=this._calcRanges(),a=s.minX,r=s.maxX,o=s.minY,n=s.maxY,l=r-a,h=n-o,d=this._scaleSize(.05),f=this._scaleSize(1),u=[],c=o-h,y=n+h,p=r+l;for(e=a-l;e<a;e+=f)y<(i=t.evaluate({x:e}))||i<c||(u.push(e),u.push(i));for(e=a;e<r;e+=d)y<(i=t.evaluate({x:e}))||i<c||(u.push(e),u.push(i));for(e=r;e<=p;e+=f)y<(i=t.evaluate({x:e}))||i<c||(u.push(e),u.push(i));return u}},{key:"_addExpression",value:function(e,i,s){t.writeMessage(this.staticLayer,"expression"+this.plots.length,10,20*this.plots.length+10,i,s,14,"bold","expression"),this.staticLayer.draw()}},{key:"clear",value:function(){for(var t=0;t<this.plots.length;t++){this.plotsLayer.findOne("#plot"+t).destroy(),this.staticLayer.findOne("#expression"+t).destroy()}this.plots=[],this.refresh(),this.staticLayer.draw()}},{key:"download",value:function(){var t=document.createElement("a");t.href=this.stage.toDataURL(),t.download="plot.png",t.click()}},{key:"_drawBg",value:function(){var t=this._calcRanges(),e=t.maxX-t.minX,s=t.maxY-t.minY,a=this.plotsLayer.findOne("#bg");a?(a.x(t.minX),a.y(t.minY),a.width(e),a.height(s)):(a=new i.default.Rect({id:"bg",x:t.minX,y:t.minY,width:e,height:s,fill:"#fff",stroke:"#fff",strokeWidth:0,opacity:0,perfectDrawEnabled:!1,shadowForStrokeEnabled:!1}),this.plotsLayer.add(a))}},{key:"_drawBorder",value:function(){var t=new i.default.Rect({id:"border",x:0,y:0,width:this.width,height:this.height,fill:this.bgColor,stroke:this.borderColor,strokeWidth:this.borderWidth,perfectDrawEnabled:!1,listening:!1,shadowForStrokeEnabled:!1});this.staticLayer.add(t)}},{key:"resetView",value:function(){this.plotsLayer.position({x:0,y:0}),this.setWindow(this._initialRanges.minX,this._initialRanges.maxX,this._initialRanges.minY,this._initialRanges.maxY,!0),this.refresh()}},{key:"zoom",value:function(t){var e=this.plotsLayer.scale(),i=this.plotsLayer.offset();this.plotsLayer.scale({x:e.x*t,y:e.y*t}),this.plotsLayer.offset({x:i.x/t,y:i.y/t}),this.refresh()}},{key:"_calcRanges",value:function(){var t=this.plotsLayer.position().x/this.plotsLayer.scaleX(),e=this.plotsLayer.position().y/this.plotsLayer.scaleY(),i=this.plotsLayer.offsetX()-t,s=this.width/this.plotsLayer.scaleX()+this.plotsLayer.offsetX()-t,a=this.height/this.plotsLayer.scaleY()+this.plotsLayer.offsetY()-e,r=this.plotsLayer.offsetY()-e;return{minX:i,maxX:s,minY:a,maxY:r,rangeX:s-i,rangeY:r-a}}},{key:"_scaleSize",value:function(t){return t/((Math.abs(this.plotsLayer.scaleX())+Math.abs(this.plotsLayer.scaleY()))/2)}},{key:"getContainer",get:function(){return this.stage.container()}}],[{key:"writeMessage",value:function(t,e,s,a,r,o){var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:14,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"normal",h=arguments.length>8?arguments[8]:void 0,d=t.findOne("#"+e);d?(d.x(s),d.y(a),d.text(r),d.fontSize(n),d.fill(o)):(d=new i.default.Text({x:s,y:a,text:r,id:e,fontSize:n,fontFamily:"Calibri",fill:o,fontStyle:l,name:h,scaleX:1/t.scaleX(),scaleY:1/t.scaleY(),listening:!1}),t.add(d))}},{key:"calcMinRatio",value:function(t,e,i,s){var a=i/t,r=s/e;return r<a?r:a}},{key:"calcFilledRanges",value:function(e,i,s,a,r,o){var n,l=i-e,h=a-s,d=t.calcMinRatio(l,h,r,o);return l*d<r?{minX:e-(n=(r/d-l)/2),maxX:i+n,minY:s,maxY:a,rangeX:i+n-(e-n),rangeY:a-s}:h*d<o?{minX:e,maxX:i,minY:s-(n=(o/d-h)/2),maxY:a+n,rangeX:i-e,rangeY:a+n-(s-n)}:{minX:e,maxX:i,minY:s,maxY:a,rangeX:i-e,rangeY:a-s}}},{key:"calcTransformMatrix",value:function(e,i,s,a,r,o){var n=t.calcMinRatio(i-e,a-s,r,o);return[n,0,0,-n,-e*n,a*n]}}]),t}();t.default=o});
//# sourceMappingURL=plotter.min.js.map
