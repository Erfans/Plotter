<!DOCTYPE html>
<html lang="en">
<head>
    <title>Plotter</title>

    <meta charset="UTF-8">
    <meta name="description" content="Draw 2D mathematical functions">
    <meta name="keywords" content="plot, function, draw math">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/gh/tkrotoff/jquery-simplecolorpicker@0.3.1/jquery.simplecolorpicker.css">
    <style>
      .simplecolorpicker.icon,
      .simplecolorpicker span.color {
        height: 20px;
        border-radius: 2px;
      }
    </style>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-8 col-12">
            <div class="my-3 justify-content-center">
                <form name="plotter" method="post" class="form-inline">
                    <label class="mr-2 mt-2 required" for="plotter_function">f(x):</label>
                    <input type="text" id="plotter_function" name="plotter_function"
                           required="required" class="mr-2 mt-2 form-control" value="sin x"/>
                    <label class="sr-only mr-2 mt-2 required" for="plotter_color">color</label>
                    <select id="plotter_color" name="plotter_color" class="form-control">
                        <option value="#C0C0C0">Silver</option>
                        <option value="#464646">Charcoal</option>
                        <option value="#084C9E">Royal Blue</option>
                        <option value="#00FFFF">Cyan</option>
                        <option value="#008080">Teal</option>
                        <option value="#808000">Olive</option>
                        <option value="#BFFF00">Lime</option>
                        <option value="#FFD700">Golden</option>
                        <option value="#FA8072">Salmon</option>
                        <option value="#B57EDC" selected="selected">Lavender</option>
                        <option value="#843179">Plum</option>
                        <option value="#800000">Maroon</option>
                        <option value="#DC143C">Crimson</option>
                    </select>
                    <button id="plotter_draw" type="button" class="btn btn-primary mx-2 mt-2">draw</button>
                    <button id="plotter_clear" type="button" class="btn btn-danger mr-2 mt-2">clear</button>
                    <button id="plotter_download" type="button" class="btn btn-success mr-2 mt-2">download</button>
                    <button id="plotter_reset" type="button" class="btn btn-secondary mr-2 mt-2">reset view</button>
                </form>
            </div>

            <div id="canvas-container"></div>

            <div class="card mt-5">
                <div class="card-header">
                    <h5 class="card-title">examples</h5>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <a onclick="plot('roundTo(sin x, 0)')" href="javascript:void(0);">
                            roundTo(sin x, 0)
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a onclick="plot('abs(max(sin x, cos x))')" href="javascript:void(0);">
                            abs(max(sin x, cos x))
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a onclick="plot('x * sin x')" href="javascript:void(0);">
                            x * sin x
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a onclick="plot('1 / log abs x')" href="javascript:void(0);">
                            1 / log abs x
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a onclick="plot('1')" href="javascript:void(0);">1</a>
                    </li>
                    <li class="list-group-item">
                        <a onclick="plot('sqrt abs sin x')" href="javascript:void(0);">sqrt abs sin x</a>
                    </li>
                </ul>
            </div>

            <div class="card mt-5">
                <div class="card-header">
                    <h5 class="card-title">references</h5>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <a href="https://github.com/silentmatt/expr-eval" target="_blank">
                            JavaScript Expression Evaluator
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://konvajs.github.io/" target="_blank">Konva.js</a>
                        (HTML5 2d canvas library for desktop and mobile applications.)
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-lg-4 col-12">
            <table class="table table-striped table-bordered mt-3 caption-top first-column-no-wrap first-column-bold">
                <caption>
                    possible operations <br/>
                    references: <a href="https://github.com/silentmatt/expr-eval">https://github.com/silentmatt/expr-eval</a>
                </caption>
                <thead>
                <tr>
                    <th>operator</th>
                    <th>description</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>-x</td>
                    <td>Negation</td>
                </tr>
                <tr>
                    <td>+x</td>
                    <td>Unary plus. This converts it's operand to a number, but has no other effect.</td>
                </tr>
                <tr>
                    <td>x!</td>
                    <td>Factorial (x * (x-1) * (x-2) * … * 2 * 1). gamma(x + 1) for non-integers.</td>
                </tr>
                <tr>
                    <td>abs x</td>
                    <td>Absolute value (magnatude) of x</td>
                </tr>
                <tr>
                    <td>acos x</td>
                    <td>Arc cosine of x (in radians)</td>
                </tr>
                <tr>
                    <td>acosh x</td>
                    <td>Hyperbolic arc cosine of x (in radians)</td>
                </tr>
                <tr>
                    <td>asin x</td>
                    <td>Arc sine of x (in radians)</td>
                </tr>
                <tr>
                    <td>asinh x</td>
                    <td>Hyperbolic arc sine of x (in radians)</td>
                </tr>
                <tr>
                    <td>atan x</td>
                    <td>Arc tangent of x (in radians)</td>
                </tr>
                <tr>
                    <td>atanh x</td>
                    <td>Hyperbolic arc tangent of x (in radians)</td>
                </tr>
                <tr>
                    <td>ceil x</td>
                    <td>Ceiling of x — the smallest integer that’s &gt;= x</td>
                </tr>
                <tr>
                    <td>cos x</td>
                    <td>Cosine of x (x is in radians)</td>
                </tr>
                <tr>
                    <td>cosh x</td>
                    <td>Hyperbolic cosine of x (x is in radians)</td>
                </tr>
                <tr>
                    <td>exp x</td>
                    <td>e^x (exponential/antilogarithm function with base e)</td>
                </tr>
                <tr>
                    <td>floor x</td>
                    <td>Floor of x — the largest integer that’s &lt;= x</td>
                </tr>
                <tr>
                    <td>length x</td>
                    <td>String length of x</td>
                </tr>
                <tr>
                    <td>ln x</td>
                    <td>Natural logarithm of x</td>
                </tr>
                <tr>
                    <td>log x</td>
                    <td>Natural logarithm of x (synonym for ln, not base-10)</td>
                </tr>
                <tr>
                    <td>log10 x</td>
                    <td>Base-10 logarithm of x</td>
                </tr>
                <tr>
                    <td>not x</td>
                    <td>Logical NOT operator</td>
                </tr>
                <tr>
                    <td>round x</td>
                    <td>X, rounded to the nearest integer, using "gradeschool rounding"</td>
                </tr>
                <tr>
                    <td>sin x</td>
                    <td>Sine of x (x is in radians)</td>
                </tr>
                <tr>
                    <td>sinh x</td>
                    <td>Hyperbolic sine of x (x is in radians)</td>
                </tr>
                <tr>
                    <td>sqrt x</td>
                    <td>Square root of x. Result is NaN (Not a Number) if x is negative.</td>
                </tr>
                <tr>
                    <td>tan x</td>
                    <td>Tangent of x (x is in radians)</td>
                </tr>
                <tr>
                    <td>tanh x</td>
                    <td>Hyperbolic tangent of x (x is in radians)</td>
                </tr>
                <tr>
                    <td>trunc x</td>
                    <td>Integral part of a X, looks like floor(x) unless for negative number</td>
                </tr>
                <tr>
                    <td>random(n)</td>
                    <td>Get a random number in the range [0, n). If n is zero, or not provided, it defaults
                        to 1.
                    </td>
                </tr>
                <tr>
                    <td>fac(n)</td>
                    <td>n! (factorial of n: "n * (n-1) * (n-2) * … * 2 * 1") Deprecated. Use the ! operator
                        instead.
                    </td>
                </tr>
                <tr>
                    <td>min(a,b,…)</td>
                    <td>Get the smallest (minimum) number in the list</td>
                </tr>
                <tr>
                    <td>max(a,b,…)</td>
                    <td>Get the largest (maximum) number in the list</td>
                </tr>
                <tr>
                    <td>hypot(a,b)</td>
                    <td>Hypotenuse, i.e. the square root of the sum of squares of its arguments.</td>
                </tr>
                <tr>
                    <td>pyt(a, b)</td>
                    <td>Alias for hypot</td>
                </tr>
                <tr>
                    <td>pow(x, y)</td>
                    <td>Equivalent to x^y. For consistency with JavaScript's Math object.</td>
                </tr>
                <tr>
                    <td>atan2(y, x)</td>
                    <td>Arc tangent of x/y. i.e. the angle between (0, 0) and (x, y) in radians.</td>
                </tr>
                <tr>
                    <td>if(c, a, b)</td>
                    <td>Function form of c ? a : b</td>
                </tr>
                <tr>
                    <td>roundTo(x, n)</td>
                    <td>Rounds x to n places after the decimal point.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- UI -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/tkrotoff/jquery-simplecolorpicker@0.3.1/jquery.simplecolorpicker.js"></script>


<!-- Plotter -->
<script src="https://cdn.jsdelivr.net/npm/expr-eval@2.0.2/dist/bundle.min.js"></script>
<script src="https://unpkg.com/konva@4.0.0/konva.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/erfans/plotter/dist/bundle.js"></script>

<script>
    const defaultColor = '888888';
    let plotter;

    // convert hash to js object
    function deserializeHash(hash) {

        hash = hash || location.hash;

        if (hash.startsWith('#!')) {
            hash = hash.substring(2);
        }

        let parts = hash.split('-and-');
        let obj = {};

        for (let i = 0; i < parts.length; i++) {
            let part = parts[i];
            let subParts = part.split('~');

            obj[decodeURI(subParts[0])] = subParts[1] || defaultColor;
        }

        return obj;
    }

    // convert js object to hash
    function serializeHash(obj) {

        let hash = '#!';
        let isFirst = true;

        for (let exp in obj) {
            let expression = encodeURI(exp);
            let color = obj[exp];

            hash += (isFirst ? '' : '-and-') + expression + (color ? '~' + color : '');
            isFirst = false;
        }

        return hash;
    }

    // update url to make applications transferable through url
    function updateUrl(plotter) {
        let exprs = plotter.plots;
        let params = {};

        for (let i = 0; i < exprs.length; i++) {
            let expr = exprs[i];
            params[expr.expression] = expr.color.replace(/^#/, '');
        }

        window.location.hash = serializeHash(params);
    }

    // plot function
    function plot(expression, color) {

        if (expression === undefined) {
            let $function = $('#plotter_function');
            // expression
            expression = $function.val();
            // clear function field
            $function.val('');
            // get focus to enter the next expression
            $function.focus();
        }

        // color
        color = color || $('#plotter_color').val();

        // plot
        plotter.plot(expression, color);

        // update url
        updateUrl(plotter);
    }

    document.addEventListener('DOMContentLoaded', function () {

        $('#plotter_color').simplecolorpicker({picker: true});

        let width = $('#canvas-container').width();
        let height = window.innerHeight - 100;

        // initial the plotter
        plotter = new Plotter('canvas-container', width, height, {minX: -5, maxX: 5, minY: -5, maxY: 5});

        // zoom
        $(plotter.getContainer).on('mousewheel DOMMouseScroll touchmove', function (e) {
            // preventing the page scroll
            e.preventDefault();
            e.stopPropagation();
            e.returnValue = false;

            let delta = navigator.userAgent.toLowerCase().indexOf('firefox') > -1 ?
                e.originalEvent.detail > 0 ? 1 / 1.2 : 1.2 :
                e.originalEvent.wheelDelta < 0 ? 1 / 1.2 : 1.2;

            plotter.zoom(delta);

            return false;
        });

        // draw plot on pressing draw button
        $('#plotter_draw').click(e => plot());

        // draw plot on pressing enter in function field
        $('#plotter_function').on('keypress', e => {
            if (e.keyCode === 13) {
                plot();
                return false;
            }
        });

        // clear plots
        $('#plotter_clear').click(e => {
            plotter.clear();

            // update url
            updateUrl(plotter);
        });

        // download plots
        $('#plotter_download').click(e => plotter.download());

        // reset view
        $('#plotter_reset').click(e => plotter.resetView());

        // plot passed functions through url hash
        let exprObj = deserializeHash();
        for (let f in exprObj) {
            plotter.plot(f, '#' + exprObj[f]);
        }
    });
</script>
</body>
</html>